const iOshishiSlot = {
  "sheet": {
    "1": {
      "index": 1,
      "binary": "00001",
      "rarity": 0,
      "rarity_str": "INSS",
      "star": 5,
      "name": "イノシシ",
      "friendly_id": "inoshishi",
      "description": "明けましておめでとうございます！",
      "probability": 0.012345679012345678,
      "p_int": 8,
      "p_acc": 8
    },
    "2": {
      "index": 2,
      "binary": "00010",
      "rarity": 1,
      "rarity_str": "SSR",
      "star": 4,
      "name": "シシ座流星群",
      "friendly_id": "leonids",
      "description": "☆彡",
      "probability": 0.012345679012345678,
      "p_int": 8,
      "p_acc": 16
    },
    "3": {
      "index": 3,
      "binary": "00011",
      "rarity": 1,
      "rarity_str": "SSR",
      "star": 4,
      "name": "　のし　",
      "friendly_id": "noshi",
      "description": "めでたい。",
      "probability": 0.012345679012345678,
      "p_int": 8,
      "p_acc": 24
    },
    "4": {
      "index": 4,
      "binary": "00100",
      "rarity": 2,
      "rarity_str": "SR",
      "star": 3,
      "name": "眠れるシシ",
      "friendly_id": "sleeping-shishi",
      "description": "説明4",
      "probability": 0.018518518518518517,
      "p_int": 12,
      "p_acc": 36
    },
    "5": {
      "index": 5,
      "binary": "00101",
      "rarity": 2,
      "rarity_str": "SR",
      "star": 3,
      "name": "イノ紳士",
      "friendly_id": "inoshinshi",
      "description": "説明5",
      "probability": 0.018518518518518517,
      "p_int": 12,
      "p_acc": 48
    },
    "6": {
      "index": 6,
      "binary": "00110",
      "rarity": 2,
      "rarity_str": "SR",
      "star": 3,
      "name": "猪突猛進",
      "friendly_id": "chototsumoushin",
      "description": "説明6",
      "probability": 0.018518518518518517,
      "p_int": 12,
      "p_acc": 60
    },
    "7": {
      "index": 7,
      "binary": "00111",
      "rarity": 2,
      "rarity_str": "SR",
      "star": 3,
      "name": "ウリボウ",
      "friendly_id": "uribo",
      "description": "説明7",
      "probability": 0.018518518518518517,
      "p_int": 12,
      "p_acc": 72
    },
    "8": {
      "index": 8,
      "binary": "01000",
      "rarity": 3,
      "rarity_str": "R",
      "star": 2,
      "name": "イおシシ",
      "friendly_id": "ioshishi",
      "description": "説明8",
      "probability": 0.027777777777777776,
      "p_int": 18,
      "p_acc": 90
    },
    "9": {
      "index": 9,
      "binary": "01001",
      "rarity": 3,
      "rarity_str": "R",
      "star": 2,
      "name": "イノシュシュ",
      "friendly_id": "inochouchou",
      "description": "説明9",
      "probability": 0.027777777777777776,
      "p_int": 18,
      "p_acc": 108
    },
    "10": {
      "index": 10,
      "binary": "01010",
      "rarity": 3,
      "rarity_str": "R",
      "star": 2,
      "name": "井上雄彦",
      "friendly_id": "inoue-takehiko",
      "description": "説明10",
      "probability": 0.027777777777777776,
      "p_int": 18,
      "p_acc": 126
    },
    "11": {
      "index": 11,
      "binary": "01011",
      "rarity": 3,
      "rarity_str": "R",
      "star": 2,
      "name": "ミドシシ",
      "friendly_id": "midoshishi",
      "description": "説明11",
      "probability": 0.027777777777777776,
      "p_int": 18,
      "p_acc": 144
    },
    "12": {
      "index": 12,
      "binary": "01100",
      "rarity": 3,
      "rarity_str": "R",
      "star": 2,
      "name": "シシがみ",
      "friendly_id": "shishigami",
      "description": "説明12",
      "probability": 0.027777777777777776,
      "p_int": 18,
      "p_acc": 162
    },
    "13": {
      "index": 13,
      "binary": "01101",
      "rarity": 3,
      "rarity_str": "R",
      "star": 2,
      "name": "いのち♥",
      "friendly_id": "inochi",
      "description": "説明13",
      "probability": 0.027777777777777776,
      "p_int": 18,
      "p_acc": 180
    },
    "14": {
      "index": 14,
      "binary": "01110",
      "rarity": 3,
      "rarity_str": "R",
      "star": 2,
      "name": "Eの指示",
      "friendly_id": "e-no-shiji",
      "description": "説明14",
      "probability": 0.027777777777777776,
      "p_int": 18,
      "p_acc": 198
    },
    "15": {
      "index": 15,
      "binary": "01111",
      "rarity": 3,
      "rarity_str": "R",
      "star": 2,
      "name": "フクシシ",
      "friendly_id": "fukushishi",
      "description": "説明15",
      "probability": 0.027777777777777776,
      "p_int": 18,
      "p_acc": 216
    },
    "16": {
      "index": 16,
      "binary": "10000",
      "rarity": 4,
      "rarity_str": "N",
      "star": 1,
      "name": "イノSiri",
      "friendly_id": "inosiri",
      "description": "説明16",
      "probability": 0.041666666666666664,
      "p_int": 27,
      "p_acc": 243
    },
    "17": {
      "index": 17,
      "binary": "10001",
      "rarity": 4,
      "rarity_str": "N",
      "star": 1,
      "name": "逗子市",
      "friendly_id": "zushishi",
      "description": "説明17",
      "probability": 0.041666666666666664,
      "p_int": 27,
      "p_acc": 270
    },
    "18": {
      "index": 18,
      "binary": "10010",
      "rarity": 4,
      "rarity_str": "N",
      "star": 1,
      "name": "猪子寿之",
      "friendly_id": "inoko-toshiyuki",
      "description": "説明18",
      "probability": 0.041666666666666664,
      "p_int": 27,
      "p_acc": 297
    },
    "19": {
      "index": 19,
      "binary": "10011",
      "rarity": 4,
      "rarity_str": "N",
      "star": 1,
      "name": "ウシシシ",
      "friendly_id": "ushishishi",
      "description": "説明19",
      "probability": 0.041666666666666664,
      "p_int": 27,
      "p_acc": 324
    },
    "20": {
      "index": 20,
      "binary": "10100",
      "rarity": 4,
      "rarity_str": "N",
      "star": 1,
      "name": "シシ16",
      "friendly_id": "shishi-16",
      "description": "説明20",
      "probability": 0.041666666666666664,
      "p_int": 27,
      "p_acc": 351
    },
    "21": {
      "index": 21,
      "binary": "10101",
      "rarity": 4,
      "rarity_str": "N",
      "star": 1,
      "name": "四捨五入",
      "friendly_id": "shishagonyu",
      "description": "説明21",
      "probability": 0.041666666666666664,
      "p_int": 27,
      "p_acc": 378
    },
    "22": {
      "index": 22,
      "binary": "10110",
      "rarity": 4,
      "rarity_str": "N",
      "star": 1,
      "name": "猪苗代湖",
      "friendly_id": "inawashiroko",
      "description": "説明22",
      "probability": 0.041666666666666664,
      "p_int": 27,
      "p_acc": 405
    },
    "23": {
      "index": 23,
      "binary": "10111",
      "rarity": 4,
      "rarity_str": "N",
      "star": 1,
      "name": "シシシシ",
      "friendly_id": "shishishishi",
      "description": "説明23",
      "probability": 0.041666666666666664,
      "p_int": 27,
      "p_acc": 432
    },
    "24": {
      "index": 24,
      "binary": "11000",
      "rarity": 4,
      "rarity_str": "N",
      "star": 1,
      "name": "イノシン",
      "friendly_id": "inosine",
      "description": "説明24",
      "probability": 0.041666666666666664,
      "p_int": 27,
      "p_acc": 459
    },
    "25": {
      "index": 25,
      "binary": "11001",
      "rarity": 4,
      "rarity_str": "N",
      "star": 1,
      "name": "シシマイ",
      "friendly_id": "shishimai",
      "description": "説明25",
      "probability": 0.041666666666666664,
      "p_int": 27,
      "p_acc": 486
    },
    "26": {
      "index": 26,
      "binary": "11010",
      "rarity": 4,
      "rarity_str": "N",
      "star": 1,
      "name": "イノ頭線",
      "friendly_id": "inokashira-line",
      "description": "説明26",
      "probability": 0.041666666666666664,
      "p_int": 27,
      "p_acc": 513
    },
    "27": {
      "index": 27,
      "binary": "11011",
      "rarity": 4,
      "rarity_str": "N",
      "star": 1,
      "name": "ノシノシ",
      "friendly_id": "noshinoshi",
      "description": "説明27",
      "probability": 0.041666666666666664,
      "p_int": 27,
      "p_acc": 540
    },
    "28": {
      "index": 28,
      "binary": "11100",
      "rarity": 4,
      "rarity_str": "N",
      "star": 1,
      "name": "いのしま",
      "friendly_id": "inoshima",
      "description": "説明28",
      "probability": 0.041666666666666664,
      "p_int": 27,
      "p_acc": 567
    },
    "29": {
      "index": 29,
      "binary": "11101",
      "rarity": 4,
      "rarity_str": "N",
      "star": 1,
      "name": "イノシカ",
      "friendly_id": "inoshika",
      "description": "説明29",
      "probability": 0.041666666666666664,
      "p_int": 27,
      "p_acc": 594
    },
    "30": {
      "index": 30,
      "binary": "11110",
      "rarity": 4,
      "rarity_str": "N",
      "star": 1,
      "name": "あのシシ",
      "friendly_id": "anoshishi",
      "description": "説明30",
      "probability": 0.041666666666666664,
      "p_int": 27,
      "p_acc": 621
    },
    "31": {
      "index": 31,
      "binary": "11111",
      "rarity": 4,
      "rarity_str": "N",
      "star": 1,
      "name": "ノノノノ",
      "friendly_id": "nononono",
      "description": "説明31",
      "probability": 0.041666666666666664,
      "p_int": 27,
      "p_acc": 648
    }
  },
  "rarity": {
    "0": {
      "rarity": 0,
      "rarity_str": "INSS"
    },
    "1": {
      "rarity": 1,
      "rarity_str": "SSR"
    },
    "2": {
      "rarity": 2,
      "rarity_str": "SR"
    },
    "3": {
      "rarity": 3,
      "rarity_str": "R"
    },
    "4": {
      "rarity": 4,
      "rarity_str": "N"
    }
  }
};

const { sheet } = iOshishiSlot;

const iOshishiArr = Object.values(sheet);

let iOshishi;

const slotElm = document.querySelector('.slot');

const compiled = _.template(`<div class="name"><%= name %></div>
  <div class="rarity"><%= rarity %></div>
  <div class="description"><%= description %></div>
`);

window.arr = iOshishiArr;

const pAcc = iOshishiArr.map(item => item.p_acc );

const pMax = _.last(pAcc);

document.querySelector('.btn-start').addEventListener('click', () => {
  slotElm.setAttribute('data-is-playing', true);

  const kuji = _.random(pMax - 1);

  console.log(kuji);

  iOshishi = iOshishiArr.filter(item => kuji < item.p_acc )[0];
});

document.querySelector('.btn-stop').addEventListener('click', () => {
  slotElm.setAttribute('data-is-playing', false);

  document.querySelectorAll('.reel').forEach((item, index) => {
    item.style = `background-position: ${- index * 64}px ${- iOshishi.index * 64}px;`;
  });

  document.querySelector('.card').innerHTML = compiled({
    name: iOshishi.name,
    rarity: iOshishi.rarity_str,
    description: iOshishi.description,
  });
});

document.querySelectorAll('.reel').forEach((item, index) => {
  item.style = `background-position: ${- index * 64}px ${- (_.random(30) + 1) * 64}px;`;
});
